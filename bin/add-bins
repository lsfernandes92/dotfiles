#!/usr/bin/env ruby
#
# Make individual bin executable system-wide.
#
# This means the binary will be added to
# `/usr/local/bin`, which is in your `$PATH`
# by default.
# 
# Anything in your $PATH is
# available from anywhere in your
# system.
#
# Multiple binaries can be added at once.
# For this, please list them separated
# by a single space.
# 
# IMPORTANT!
# Don't forget to change the `BINS_DIR`
# constant to point to where your file is.
# 
# OS SUPPORT:
#   Linux and MacOS
#  
# SOURCE:
#   https://github.com/lsfernandes92/awesome-scripts/tree/main/public/bins/system-wide-bin/add-bins
#   
# USAGE:
#   $ ./add-bins
#   ğŸ’¬ Which binary would you like to add? To add multiple binaries at once, please list them separated by a single space.
#   >_rimshot
#   # => Add 'rimshot' executable system-wide
#   
#   $ ./add-bins
#   ğŸ’¬ Which binary would you like to add? To add multiple binaries at once, please list them separated by a single space.
#   >_rimshot open-repo
#   # => Add 'rimshot' and 'open-repo' executable system-wide
USR_LOCAL_BIN_DIR = "/usr/local/bin"
BINS_DIR = "#{ENV['HOME']}/.dotfiles/bin" # CHANGE THIS!

def append_puts_message
  puts "\n"
  yield
  print "\n>_"
end

def make_bin_executable(bin)
  append_puts_message { puts "ğŸ’¬ To make '#{bin}' executable, sudo is required. Do you even trust this script? (ğ“¹â€¿ ğ“¹)" }
  
  bin_path = "#{BINS_DIR}/#{bin}"
  
  if system('sudo', 'chmod', '+x', bin_path)
    puts "\nâœ… '#{bin}' is now executable!"
  else
    puts "âŒ Failed to make '#{bin}' executable"
    exit 1
  end
end

def symlink_bin(bin)
  source = "#{BINS_DIR}/#{bin}"
  target = "#{USR_LOCAL_BIN_DIR}/#{bin}"
  
  system('sudo', 'rm', '-f', target)
  
  if system('sudo', 'ln', '-s', source, target)
    puts "âœ… Symlinked '#{bin}' to #{USR_LOCAL_BIN_DIR}"
  else
    puts "âŒ Failed to symlink '#{bin}'"
    exit 1
  end
end

def process(bin_list)
  bin_list.split(' ').each do |bin|
    make_bin_executable(bin)
    symlink_bin(bin)
  end
end

def rehash
  system('rbenv', 'rehash') if system("which rbenv > /dev/null 2>&1")
end

append_puts_message { print "ğŸ’¬ Which binary would you like to add? To add multiple binaries at once, please list them separated by a single space." }

bin_list = gets.chomp

process(bin_list)
rehash

puts "âœ… Done! You may need to reload your terminal."
