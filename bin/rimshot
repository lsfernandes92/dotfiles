#!/usr/bin/env ruby
#
# Simply plays a rimshot sound.
#
# USAGE:
#
#   $ ./rimshot
#   # => plays a rimshot sound

DOWNLOADS_DIRECTORY = "#{ENV['HOME']}/Downloads"
SOUND_FILE_NAME = 'rimshot.mp3'

def mp3_previously_downloaded?
  !`find #{DOWNLOADS_DIRECTORY} -name "#{SOUND_FILE_NAME}"`.strip.empty?
end

def download_or_skip
  unless mp3_previously_downloaded?
    system "curl https://instantrimshot.com/audio/rimshot.mp3 -o #{DOWNLOADS_DIRECTORY}/#{SOUND_FILE_NAME} 2>/dev/null"
  end
end

def play
  os = RbConfig::CONFIG['host_os']

  case os
  when /darwin|mac os/
    spawn "nohup afplay #{DOWNLOADS_DIRECTORY}/#{SOUND_FILE_NAME} > /dev/null"
  when /linux/
    spawn "nohup aplay #{DOWNLOADS_DIRECTORY}/#{SOUND_FILE_NAME} > /dev/null"
  else
    puts "⚠️ Unsupported OS. This script only works on MacOS and Linux. ¯\\_(ツ)_/¯"
  end
end

download_or_skip
play
